/*
  Blagger JS
  jostein.topland@gmail.com
*/

var levels = [{
  name: "the bank",
  map: [
    0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x02, 0x02,
    0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x02, 0x02,
    0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x02, 0x02,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03,
    0x06, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x09, 0x09, 0x00, 0x00, 0x01, 0x04, 0x01,
    0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x05, 0x01,
    0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01,
    0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x04, 0x01,
    0x01, 0x09, 0x30, 0x30, 0x30, 0x30, 0x09, 0x09, 0x09, 0x09, 0x06, 0x09, 0x09, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x05, 0x01,
    0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x09, 0x09, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x00, 0x30, 0x30, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x09, 0x09, 0x09, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x04, 0x04, 0x01, 0x01, 0x04, 0x04, 0x01, 0x04, 0x04, 0x01,
    0x01, 0x00, 0x30, 0x30, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x10, 0x00, 0x00, 0x00, 0x09, 0x09, 0x09, 0x00, 0x00, 0x01, 0x05, 0x05, 0x01, 0x01, 0x05, 0x05, 0x01, 0x05, 0x05, 0x01,
    0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x11, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x00, 0x30, 0x30, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x09, 0x09, 0x09, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x11, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x04, 0x04, 0x01, 0x04, 0x04, 0x01,
    0x01, 0x21, 0x21, 0x21, 0x21, 0x21, 0x21, 0x21, 0x01, 0x01, 0x08, 0x00, 0x00, 0x09, 0x09, 0x09, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x05, 0x05, 0x01, 0x05, 0x05, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01
  ],
  sprites: [
    [0x40, 186, 16],
    [0x13, 203, 60],
    [0x41, 120, 128],
  ],
  width: 31,
  height: 19
}];

var sprites = {
  spritesheet: null,
  coords: {
    0x01: [0, 0, 8, 8],
    0x02: [8, 0, 8, 8],
    0x03: [16, 0, 8, 8],
    0x04: [24, 0, 8, 8],
    0x05: [32, 0, 8, 8],
    0x06: [40, 0, 8, 8],
    0x07: [48, 0, 8, 8],
    0x08: [56, 0, 8, 8],
    0x09: [64, 0, 8, 8],
    0x10: [0, 8, 8, 8], // key
    0x11: [8, 8, 8, 8],
    0x12: [16, 8, 8, 8],
    0x13: [0, 72, 21, 13],
    0x20: [0, 16, 8, 8, 8],
    0x21: [0, 24, 8, 8, 8],
    0x30: [0, 32, 8, 8],
    0x40: [0, 40, 21, 16],
    0x41: [0, 56, 21, 16],
  },
  gridSize: 8
};

function preload() {
  sprites.spritesheet = loadImage("spritesheet.png");
}

function setup() {
	createCanvas(windowWidth, windowHeight);
  noSmooth();
  frameRate(20);
}

function draw() {
  scale(3 );
  background('black');
  drawLevel();
}

function drawLevel() {
  let level = levels[0];
  for (let i = 0; i < level.map.length; i++) {
    if (level.map[i] == 0x00) continue;
    let x = i % level.width * sprites.gridSize;
    let y = floor(i / level.width) * sprites.gridSize;
    let coord = sprites.coords[level.map[i]];
    let xCoord = coord[0];
    if (coord[4] != undefined) xCoord += coord[2] * (frameCount % coord[4]);
    image(sprites.spritesheet, x, y, coord[2], coord[3], xCoord, coord[1], coord[2], coord[3]);
  }
  for (let i = 0; i < level.sprites.length; i++) {
    let coordId = level.sprites[i][0];
    let x = level.sprites[i][1];
    let y = level.sprites[i][2];
    let coord = sprites.coords[coordId];
    let xCoord = coord[0];
    //if (coord[4] != undefined) xCoord += coord[2] * (frameCount % coord[4]);
    image(sprites.spritesheet, x, y, coord[2], coord[3], xCoord, coord[1], coord[2], coord[3]);
  }
}

function keyPressed() {
  //if (keyCode == LEFT_ARROW) jetFighter.direction = -1;
}

function keyReleased() {
}
